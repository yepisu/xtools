(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[736],{78249:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/watermark",function(){return n(95598)}])},3203:function(e,t,n){"use strict";var r=n(85893),l=n(5616),o=n(67294);t.Z=e=>{let t=(0,o.useCallback)(t=>{if(e.src){let t=/^data:[a-zA-Z0-9]+\/([a-zA-Z0-9]+)[^;]*;base64,/.exec(e.src);if(t&&t[1]){let n=document.createElement("a");n.style.display="none",n.href=e.src,n.download="保存图片."+t[1],document.body.appendChild(n),n.click()}}},[e.src]);return(0,r.jsxs)(l.Z,{sx:{width:"100%",padding:"20px",position:"relative",display:"inline-block",border:"black solid 1px",borderColor:"rgba(0, 0, 0, 0.2)",borderRadius:"4px",...e.sx},children:[e.src?(0,r.jsx)("img",{src:e.src,style:{width:"100%",height:"100%"}}):(0,r.jsx)(r.Fragment,{}),(0,r.jsxs)(l.Z,{sx:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"1",cursor:"pointer",color:"rgba(0,0,0,0)",fontSize:"14px",textAlign:"center",userSelect:"none",paddingTop:"20px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.5)",color:e.src?"rgba(255,255,255,1)":""}},onClick:t,children:[" ","点击下载图片"," "]})]})}},43197:function(e,t,n){"use strict";var r=n(85893),l=n(70671),o=n(88613),s=n(47023),i=n(37375),a=n(55343),c=n(51233),d=n(5616),u=n(15861),x=n(25662),m=n(67294);t.Z=e=>{let{children:t,sx:n,fullScreen:f=!0}=e,{path:h}=(0,o.hI)(),[p]=m.useState(i.Z.find(e=>e.path===h));return(0,m.useEffect)(()=>{let e=e=>{if(!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)){let e=document.getElementById("fullscreen-element"),t=document.getElementById("rivers-header");e&&(e.style.position="unset",e.style.inset="0",e.style.maxWidth="unset",e.style.padding="0",t&&(t.style.display="block"))}};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}},[]),(0,r.jsxs)(c.Z,{sx:{px:"50px",py:2,overflow:"auto",flex:1,borderRadius:"8px",background:"#fff",boxShadow:"0px 0px 2px 0px rgba(145,158,171,0.2), 0px 12px 24px -4px rgba(145,158,171,0.12)",...n},children:[(0,r.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(d.Z,{children:(0,r.jsx)(u.Z,{sx:{mb:"0px",fontWeight:600,color:l.Z2,fontSize:"20px"},gutterBottom:!0,variant:"subtitle1",component:"div",children:null==p?void 0:p.label})}),(0,r.jsx)(c.Z,{direction:"row",sx:{fontFamily:"Mono"},children:s.i.filter(e=>null==p?void 0:p.tags.includes(e.name)).map(e=>(0,r.jsx)(d.Z,{sx:{height:"24px",lineHeight:"24px",fontSize:"12px",background:"rgba(52,90,255,0.1)",color:"#345AFF",px:1,borderRadius:1,ml:1},children:e.label},e.name))})]}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{position:"relative",width:"100%",alignSelf:"stretch",mb:"24px"},children:[(0,r.jsx)(u.Z,{variant:"caption",sx:{display:"inline-block",maxWidth:"100%",pl:"6px",color:"rgba(11,37,98,0.5)",background:"rgba(11,37,98,0.04)",borderRadius:1,lineHeight:"24px"},children:null==p?void 0:p.subTitle}),f?(0,r.jsx)(x.Z,{size:"small",onClick:()=>{let e=document.body;new Promise(t=>{(null==e?void 0:e.requestFullscreen)?t(e.requestFullscreen()):(null==e?void 0:e.mozRequestFullScreen)?t(null==e?void 0:e.mozRequestFullScreen()):(null==e?void 0:e.webkitRequestFullscreen)?t(null==e?void 0:e.webkitRequestFullscreen()):(null==e?void 0:e.msRequestFullscreen)&&t(null==e?void 0:e.msRequestFullscreen())}).then(()=>{let e=document.getElementById("fullscreen-element"),t=document.getElementById("rivers-header");e&&(e.style.position="fixed",e.style.inset="0",e.style.maxWidth="100vw",e.style.background="#fff",e.style.padding="84px 14px 14px 14px",t&&(t.style.display="none"))})},sx:{borderRadius:"4px",height:"24px"},variant:"outlined",startIcon:(0,r.jsx)(a.Z,{}),children:"全屏"}):null]}),(0,r.jsx)(c.Z,{id:"fullscreen-element",sx:{gap:"18px",maxWidth:"1020px",fontFamily:"Mono",mx:"auto",flex:1,width:"100%"},children:t})]})}},95598:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(85893),l=n(43197),o=n(67294),s=n(94184),i=n.n(s);function a(){}n(47854);let c=o.createContext({add:a,remove:a});function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=document.createElement("canvas"),l=r.getContext("2d"),o=e*n,s=t*n;return r.setAttribute("width","".concat(o,"px")),r.setAttribute("height","".concat(s,"px")),l.save(),[l,r,o,s]}let u={visibility:"visible !important"};function x(e,t){return e.size===t.size?e:t}var m=e=>{var t,n;let{zIndex:l=9,rotate:s=-22,width:a,height:m,image:f,content:h,font:p={},style:g,className:v,rootClassName:b,gap:j=[100,100],offset:w,children:y,inherit:Z=!0,onWaterMarkChange:S}=e,{color:E="rgba(0,0,0,.15)",fontSize:z=16,fontWeight:k="normal",fontStyle:C="normal",fontFamily:M="sans-serif",textAlign:F="center"}=p,[I=100,A=100]=j,R=I/2,q=A/2,L=null!==(t=null==w?void 0:w[0])&&void 0!==t?t:R,_=null!==(n=null==w?void 0:w[1])&&void 0!==n?n:q,P=o.useMemo(()=>{let e={zIndex:l,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"},t=L-R,n=_-q;return t>0&&(e.left="".concat(t,"px"),e.width="calc(100% - ".concat(t,"px)"),t=0),n>0&&(e.top="".concat(n,"px"),e.height="calc(100% - ".concat(n,"px)"),n=0),e.backgroundPosition="".concat(t,"px ").concat(n,"px"),e},[l,L,R,_,q]),[T,B]=o.useState(),[N,Q]=o.useState(new Set),W=o.useMemo(()=>[...T?[T]:[],...Array.from(N)],[T,N]),D=e=>{let t=120,n=64;if(!f&&e.measureText){e.font="".concat(Number(z),"px ").concat(M);let r=Array.isArray(h)?h:[h],l=r.map(t=>{let n=e.measureText(t);return[n.width,n.fontBoundingBoxAscent+n.fontBoundingBoxDescent]});t=Math.ceil(Math.max(...l.map(e=>e[0]))),n=Math.ceil(Math.max(...l.map(e=>e[1])))*r.length+(r.length-1)*3}return[null!=a?a:t,null!=m?m:n]},O=function(e,t,n,r,l,o,s,i){let[a,c,u,x]=d(r,l,n);if(e instanceof HTMLImageElement)a.drawImage(e,0,0,u,x);else{let{color:t,fontSize:r,fontStyle:s,fontWeight:i,fontFamily:c,textAlign:d}=o,x=Number(r)*n;a.font="".concat(s," normal ").concat(i," ").concat(x,"px/").concat(l,"px ").concat(c),a.fillStyle=t,a.textAlign=d,a.textBaseline="top";let m=Array.isArray(e)?e:[e];null==m||m.forEach((e,t)=>{a.fillText(null!=e?e:"",u/2,t*(x+3*n))})}let m=Math.PI/180*Number(t),f=Math.max(r,l),[h,p,g]=d(f,f,n);h.translate(g/2,g/2),h.rotate(m),u>0&&x>0&&h.drawImage(c,-u/2,-x/2);let v=0,b=0,j=0,w=0,y=u/2,Z=x/2;[[0-y,0-Z],[0+y,0-Z],[0+y,0+Z],[0-y,0+Z]].forEach(e=>{let[t,n]=e,[r,l]=[t*Math.cos(m)-n*Math.sin(m),t*Math.sin(m)+n*Math.cos(m)];v=Math.min(v,r),b=Math.max(b,r),j=Math.min(j,l),w=Math.max(w,l)});let S=v+g/2,E=j+g/2,z=b-v,k=w-j,C=s*n,M=i*n,F=(z+C)*2,I=k+M,[A,R]=d(F,I);function q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;A.drawImage(p,S,E,z,k,e,t,z,k)}return q(),q(z+C,-k/2-M/2),q(z+C,+k/2+M/2),[R.toDataURL(),F/n,I/n]},[H,U]=o.useState(null),[X,G,V]=function(e){let[t]=o.useState(()=>new Map);return[(n,r,l)=>{if(l){var o;if(!t.get(l)){let e=document.createElement("div");t.set(l,e)}let s=t.get(l);s.setAttribute("style",Object.keys(o={...e,backgroundImage:"url('".concat(n,"')"),backgroundSize:"".concat(Math.floor(r),"px"),...u}).map(e=>"".concat(e.replace(/([A-Z])/g,"-$1").toLowerCase(),": ").concat(o[e],";")).join(" ")),s.removeAttribute("class"),l.append(s)}},e=>{let n=t.get(e);n&&e&&e.removeChild(n),t.delete(e)},e=>Array.from(t.values()).includes(e)]}(P);(0,o.useEffect)(()=>{H&&W.forEach(e=>{X(H[0],H[1],e)})},[H,W]),(0,o.useEffect)(()=>{let e=document.createElement("canvas").getContext("2d");if(e){let t=window.devicePixelRatio||1,[n,r]=D(e),l=e=>{let[l,o]=O(e||"",s,t,n,r,{color:E,fontSize:z,fontStyle:C,fontWeight:k,fontFamily:M,textAlign:F},I,A);U([l,o]),null==S||S(l)};if(f){let e=new Image;e.onload=()=>{l(e)},e.onerror=()=>{l(h)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=f}else l(h)}},[s,l,a,m,f,h,E,z,k,C,M,F,I,A,L,_]);let $=o.useMemo(()=>({add:e=>{Q(t=>{let n=new Set(t);return n.add(e),x(t,n)})},remove:e=>{G(e),Q(t=>{let n=new Set(t);return n.delete(e),x(t,n)})}}),[]),J=Z?(0,r.jsx)(c.Provider,{value:$,children:y}):y;return(0,r.jsx)("div",{ref:B,className:i()(v,b),style:{position:"relative",...g},children:J})},f=n(5616),h=n(51233),p=n(25662),g=n(61903),v=n(87536),b=n(90948),j=n(3203);let w=(0,b.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});var y=()=>{let{control:e,formState:{errors:t},watch:n}=(0,v.cI)({defaultValues:{context:"水印文字",color:"rgba(0,0,0,.15)",fontSize:16,gap:[100,100],offset:[0,0]}}),[s,i]=(0,o.useState)(""),[a,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),x=n(),b=(e,t)=>{if(""===e||""===t)return;let n=document.createElement("canvas"),r=n.getContext("2d"),l=new Image;l.onload=function(){let e=new Image;e.onload=function(){n.width=l.width,n.height=l.height,r.drawImage(l,0,0);let t=r.createPattern(e,"repeat");r.fillStyle=t,r.fillRect(x.offset[0],x.offset[1],n.width,n.height),u(n.toDataURL("image/jpeg"))},e.src=t},l.src=e};return(0,o.useEffect)(()=>{b(s,a)},[x.offset[0],x.offset[1]]),(0,r.jsx)(l.Z,{children:(0,r.jsxs)(f.Z,{sx:{width:"100%",typography:"body1"},children:[(0,r.jsxs)(h.Z,{spacing:3,sx:{color:"#FF1844"},children:[(0,r.jsxs)(p.Z,{component:"label",variant:"outlined",children:["选择图片",(0,r.jsx)(w,{type:"file",onChange:e=>{let t=e.target.files||[];if(0==t.length)return;let n=new FileReader;n.onload=function(e){null!=e.target&&(i(e.target.result),b(e.target.result,a))},n.readAsDataURL(t[0])}})]}),(0,r.jsxs)(f.Z,{sx:{display:"flex",flexWrap:"wrap",columnGap:3},children:[(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["水印文字",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"context",control:e,render:e=>{var n;let{field:l}=e;return(0,r.jsx)(g.Z,{required:!0,...l,variant:"outlined",error:!!t.context,helperText:null===(n=t.context)||void 0===n?void 0:n.message,size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["水印颜色",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"color",control:e,render:e=>{let{field:t}=e;return(0,r.jsx)(g.Z,{required:!0,...t,variant:"outlined",size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["字体大小",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"fontSize",control:e,render:e=>{let{field:t}=e;return(0,r.jsx)(g.Z,{required:!0,...t,variant:"outlined",size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["水印横间隔",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"gap.0",control:e,render:e=>{let{field:t}=e;return(0,r.jsx)(g.Z,{required:!0,...t,variant:"outlined",size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["水印纵间隔",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"gap.1",control:e,render:e=>{var n;let{field:l}=e;return(0,r.jsx)(g.Z,{required:!0,...l,variant:"outlined",error:!!t.context,helperText:null===(n=t.context)||void 0===n?void 0:n.message,size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["横向偏移量",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"offset.0",control:e,render:e=>{let{field:t}=e;return(0,r.jsx)(g.Z,{required:!0,...t,variant:"outlined",size:"small",autoComplete:"off"})}})})]}),(0,r.jsxs)(f.Z,{sx:{fontSize:"14px",color:"text.secondary",mb:2},children:["纵向偏移量",(0,r.jsx)(f.Z,{sx:{mt:.5},children:(0,r.jsx)(v.Qr,{name:"offset.1",control:e,render:e=>{var n;let{field:l}=e;return(0,r.jsx)(g.Z,{required:!0,...l,variant:"outlined",error:!!t.context,helperText:null===(n=t.context)||void 0===n?void 0:n.message,size:"small",autoComplete:"off"})}})})]})]})]}),s&&(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(j.Z,{src:d}),(0,r.jsx)(m,{content:x.context,font:{color:x.color,fontSize:x.fontSize||16},gap:x.gap,onWaterMarkChange:e=>{b(s,e),c(e)}})]})]})})}}},function(e){e.O(0,[1419,9774,2888,179],function(){return e(e.s=78249)}),_N_E=e.O()}]);